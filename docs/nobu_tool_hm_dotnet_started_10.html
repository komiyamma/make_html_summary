<div class="content-box mb-3 content-lighten">
<h2><i class="fa fa-book fa-fw"></i>入門編 ～秀丸マクロ上の変数の値を読み取る・書き換える～</h2>
</div>
<div class="content-box mb-3 content-lighten">
        <h3>概要</h3>
        <p>
            hm.NETでは秀丸マクロで定義されている変数（秀丸マクロからあらかじめ提供されているもの、<br>
            ユーザーが独自に定義したもののどちらでも）を取得、
            値を書き換えることが出来ます。<br>
            (※秀丸があらかじめ提供している読み取り専用のシンボルの値は書き換えることが出来ません)
        </p>
        <p></p>
</div>
<div class="content-box mb-3 content-lighten">
        <h3>
            秀丸マクロ上の変数の値を読み取る・書き換える
        </h3>
        <p>マクロ実行中のみ、読み取り・書き換え可能</p>
        <blockquote>Hm.Macro.Var["変数名"]</blockquote>
        <ul class="pointlist">
            <li>
                <h4>C#側のソース</h4>
                <fieldset class="code">
                    <legend>MyTestForm.cs</legend><pre class="brush:csharp">using System;
using System.Windows.Forms;
using Hidemaru;

namespace HmTest
{
    partial class HmTestForm
    {
        protected void MethodCreate()
        {
            System.Diagnostics.Trace.WriteLine("フォーム生成時");

            var fn1 = Hm.Edit.FilePath;
            System.Diagnostics.Trace.WriteLine(fn1);
            var fn2 = Hm.Macro.Var["filename2"];
            System.Diagnostics.Trace.WriteLine(fn2);
            Hm.Macro.Var["$bbdd"] = "文字列変数への代入";
            Hm.Macro.Var["#ccef"] = -33;

            // 秀丸マクロの数値の変数を取得する際は、以下のように一度(dynamic)を挟むこと
            var column = (int)(dynamic)Hm.Macro.Var["column"];

            // 上と同じようにdynamicで、こちらはユーザー定義の変数を取得
            var cccc = (int)(dynamic)Hm.Macro.Var["#cccc"];
        }
        protected void MethodTick()
        {
            System.Diagnostics.Trace.WriteLine("チック時");
        }
        protected void MethodDestroy()
        {
            System.Diagnostics.Trace.WriteLine("フォームクローズ時");
        }
    }

}

</pre>
                </fieldset>
                <p>
                   
                        秀丸マクロ上の変数取得において、「数値変数」をC#側から取得する際には注意を要します。<br>
                        秀丸エディタは32bit版と64bit版が存在するので、どちらの版でも<span class="negative">
    共通のC#ソースにするためには、<br>
    dynamicに一度キャストして型情報を問わないようにしておく必要があります。<br>
   直接intでキャストすると、秀丸エディタ64bit版では、実行時にlong型をint型にキャストすることになるため、キャスト不可能な例外が発生してしまいます。
</span>
                </p>
            </li><li>
                <h4>秀丸マクロ側のソース</h4>

                <fieldset class="code">
                    <legend>HmNETTest.macなどと適当に名前を付ける</legend><pre class="brush:hmmacro">debuginfo 1;
debuginfo "macro start\n";

#cccc = -1000;

#HMNET = loaddll( hidemarudir + @"\hm.NET.dll" );
#r = dllfuncw( #HMNET, "SetDetachMethod", currentmacrodirectory + @"\HmTest.dll", "HmTest.HmTestClass", "OnDetachMethod" );
#r = dllfuncw( #HMNET, "CallMethod", currentmacrodirectory + @"\HmTest.dll", "HmTest.HmTestClass", "CreateForm" );

message $bbdd;
message str(#ccef);

debuginfo "macro end\n";


</pre>
                </fieldset>
                <p>一度マクロを実行し、「デバッグモニター」にどのように順次表示されるか確認しましょう。</p>
                <p>
                    C#側から変数へと設定した値を、秀丸マクロ(*.mac)側から、ダイアログで表示しています。
                </p>
        </li></ul>
</div>
