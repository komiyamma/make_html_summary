<div class="content-box mb-3 content-lighten">
    <h2><i class="fa fa-book fa-fw"></i>入門編 ～秀丸マクロの「(関数のような)命令文」を文字列で実行～</h2>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>概要</h3>
    <p><mark>この機能を利用する場合、秀丸エディタ v8.98 (正式版 or β9以上)を強く推奨します。<br>
        そうでない場合、数値と文字列の型を間違えて実行すると秀丸が不正な状態となります。</mark></p>
        <p>
        Hm.Macro.Eval(...)を「命令向けに特化」したものとして、「Hm.Macro.Statement」が用意されています。
    </p>
    <p>秀丸マクロにおいて「(関数のような)文」や「(関数のような)命令文」とは</p>
    <blockquote>moveto Ｘ座標, Ｙ座標</blockquote>
    <p>のように呼び出しに<mark>「( )」が使われず</mark>、かつ、<mark>返り値を受け取らない</mark>ものです。</p>
    <p>一方、文と類似ですが<a href="?page=nobu_tool_hm_dotnet_started_macro_function">「返り値」があり、「( )」を付けて呼び出すものを「関数」</a>としています。<br>
    </p>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>
        秀丸マクロの(関数のような)文を実行可能です。<br>
    </h3>
    <p><mark>マクロ実行中のみ実行可能</mark></p>
    <blockquote>Hm.Macro.Statement("秀丸マクロの文名", ...引数);</blockquote>
    <ul class="pointlist">
        <li>
            <h4>C#側のソース</h4>
            <fieldset class="code">
                <legend>MyTestForm.cs</legend>
                <pre class="brush:csharp">using System;
using System.Windows.Forms;
using Hidemaru;

namespace HmTest
{
partial class HmTestForm
{
    protected void MethodCreate()
    {
        System.Diagnostics.Trace.WriteLine("フォーム生成時");

        var ret = Hm.Macro.Statement("moveto", 10, 2); // X:10, Y:2 の位置に移動
        if (ret.Error == null )
        {
            Hm.OutputPane.Output("実行成功\r\n");
        }
        else
        {
            Hm.OutputPane.Output("実行失敗\r\n");
        }
    }
    protected void MethodTick()
    {
        System.Diagnostics.Trace.WriteLine("チック時");
    }
    protected void MethodDestroy()
    {
        System.Diagnostics.Trace.WriteLine("フォームクローズ時");
    }
}

}

</pre>
            </fieldset>

        </li><li>
            <h4>秀丸マクロ側のソース</h4>
            <p>
                前章の「HmNETTest.mac」と同一です。<br>
            </p>
    </li></ul>
</div>

<div class="content-box mb-3 content-lighten">
    <h3>
        引数として「配列」を必要とする関数のような文
    </h3>
    <p>秀丸マクロの文や関数にはごく一部には「menuarray」など
        引数として「配列」を必要とするものがあります。</p>
    <p>今回は「<a href="https://help.maruo.co.jp/hidemac/html/120_InputStatement_menu_mousemenu_menuarray_mousemenuarray.html">秀丸マクロ文のmenuarray</a>」を利用してみましょう。</p>
    <ul class="pointlist">
        <li>
            <h4>C#側のソース</h4>
            <fieldset class="code">
                <legend>MyTestForm.cs</legend>
                <pre class="brush:csharp">using System;
using System.Windows.Forms;
using Hidemaru;

namespace HmTest
{
partial class HmTestForm
{
    protected void MethodCreate()
    {
        System.Diagnostics.Trace.WriteLine("フォーム生成時");

            try
            {
                var menulist = new List&lt;String&gt;()
                {
                    "１ばんめ",
                    "２ばんめ",
                    "３ばんめ"
                };
                var ret = Hm.Macro.Statement("menuarray", menulist, menulist.Count);
                var selectedId = (int)(dynamic)Hm.Macro.Var["result"];
                Hm.OutputPane.Output($"{selectedId}\r\n");
            }
            catch (Exception e)
            {
                Hm.OutputPane.Output("エラー");
            }
    }
    protected void MethodTick()
    {
        System.Diagnostics.Trace.WriteLine("チック時");
    }
    protected void MethodDestroy()
    {
        System.Diagnostics.Trace.WriteLine("フォームクローズ時");
    }
}

}

</pre>
            </fieldset>
        </li>
    </ul>
</div>

<div class="content-box mb-3 content-lighten">
    <h3>秀丸マクロ側のソース</h3>
    <p>
        前章の「HmNETTest.mac」と同一です。<br>
    </p>
</div>

<div class="content-box mb-3 content-lighten">
    <h3>Hm.Macro.Statement(...) 返り値</h3>

    <ul class="arrowlist">
        <li>
            <h5>Resultプロパティ</h5>
            <p>
                実行した秀丸マクロ文が無事成功したなら「秀丸マクロのresult相当の値が」、失敗したなら「0」以下がint型で入っています。<br>
                0とは限らないので注意してください。<br>
                ステートメントの実行そのものが成功したのかはResultプロパティではなくErrorプロパティで判定してください。<br>
                Resultプロパティでは実行に成功した結果、マイナスのresult値が返ってきていることもあり得ます。
            </p>
        </li>
        <li>
            <h5>Argsプロパティ</h5>
            <p>
                秀丸マク関数を実行した後、秀丸マクロ関数に渡した引数が最終的にどういった値になったかを取得できます。<br>
                List&lt;Object&gt;型で、関数に渡した最初の引数が[0], 次の引数が[1], ... といった形で格納されています。
                各種リスト要素はObject型になっていますので、取得するには(string)もしくは(dynamic)にキャストした後、(int)や(long)でのキャストが必要です。
            </p>
        </li>
        <li>
            <h5>Errorプロパティ</h5>
            <p>
                何か明確な例外が発生した場合はErrorプロパティにException型の例外インスタンスが入っています。<br>
            </p>
        </li>
        <li>
            <h5>Messageプロパティ</h5>
            <p>
                基本的には特になにもはいっておらず、空文字が入っています。<br>
            </p>
        </li>
    </ul>
</div>