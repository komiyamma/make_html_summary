<div class="content-box mb-3 content-lighten">
    <h2><i class="fa fa-book fa-fw"></i>HmPerplexityWeb を外部マクロから呼び出す</h2>
</div>

<div class="content-box mb-3 content-lighten">
    <h3>概要</h3>
    <p>
        質問内容について、外部マクロから呼び出すことで、定型的にAIを利用するマクロを組むことが出来ます。
    </p>
</div>


<div class="content-box mb-3 content-lighten">
    <h3>以下のマクロファイルを作成し、HmPerplexityWeb.mac と同じフォルダに入れてください。</h3>
    <fieldset class="code">
        <legend>test1.mac</legend>
        <p></p>
        <pre class="brush:js;highlight:[1,4,5,8]">jsmode @"WebView2\HmPerplexityWeb";
js {

function onRequestQuestionText() {
    return "1+1は？";
}

hidemaru.postExecMacroFile( currentmacrodirectory() + "\\HmPerplexityWeb.mac" );

} // js
</pre>
    </fieldset>
    <p><img src="./other_soft/hm_perplexity_web/cnt_hm_perplexity_web_10.png"></p>
    <h4>jsmode は "WebView2\HmPerplexityWeb"</h4>
    <p>HmPerplexityWebと同じ実行空間で走らせます。</p>
    <h4>onRequestQuestionText() という関数を定義し、質問内容を返す</h4>
    <p>onRequestQuestionText() を定義して、最終的に質問内容を返すと、<br>
    そのままPerplexityへの問い合わせ内容となります。</p>
    <h4>HmPerplexityWebへと処理を移す</h4>
    <blockquote>currentmacrodirectory() + "\\HmPerplexityWeb.mac"</blockquote>
    <p>
        の「<mark>フルパス指定の部分を適切に修正</mark>」出来るなら、<br>
        「test1.mac」と「HmPerplexityWeb.mac」を<mark>同じフォルダに配置する必要はありません</mark>。
    </p>
</div>


<div class="content-box mb-3 content-lighten">
    <h3>「質問内容」を「マクロの引数」として渡せるように出来ますか？</h3>
    <p>将来の互換性のため、HmPerplexityWeb.mac 本体には、そのような機能を持たせていません。</p>
    <p>以下のような「間をとりもつマクロ」を作成し、<mark>HmPerplexityWeb.mac と同じフォルダに配置する</mark>と良いでしょう。</p>
    <h4>HmPerplexityWebArg.macの作成</h4>
    <fieldset class="code">
        <legend>HmPerplexityWebArg.mac (<mark>HmPerplexityWeb.macと同じフォルダ</mark>に配置)</legend>
        <pre class="brush:js">jsmode @"WebView2\HmPerplexityWeb";
js {

var _myQuestionTextCache = getarg(0);

function onRequestQuestionText() {
    return _myQuestionTextCache;
}

hidemaru.postExecMacroFile( currentmacrodirectory() + "\\HmPerplexityWeb.mac" );

} // js
</pre>
    </fieldset>

    <h4>外部マクロからは、この「HmPerplexityWebArg.mac」を呼び出すようにする</h4>
    <fieldset class="code">
        <legend>test4.mac</legend>
        <pre class="brush:js">execmacro currentmacrodirectory + "\\HmPerplexityWebArg.mac", "1+1は？";
</pre>
    </fieldset>
    <p><img src="./other_soft/hm_perplexity_web/cnt_hm_perplexity_web_10.png"></p>
</div>