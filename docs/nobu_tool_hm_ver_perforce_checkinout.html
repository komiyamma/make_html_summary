<div class="content-box mb-3 content-lighten">
    <h2><i class="fa fa-history fa-fw"></i>秀丸マクロ・Perforceのチェックイン・チェックアウト</h2>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>概要</h3>
    <p>
        バージョン管理ツール「Perforce(通称:P4)」への、
        チェックアウト・チェックインをするための簡易マクロです。
    </p>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>ダウンロード</h3>

    <div class="card mb-3 ms-3" style="max-width: 30rem;">
        <div class="card-body text-center">
            <div class="row">
                <div class="col-12"><small>更新日 %(year)04d/%(mon)02d/%(mday)02d</small></div>
            </div>
            <a href="%(file)s" class="btn btn-primary"><i class="fa fa-download fa-fw"></i>HmPerforceCheckInOut.zip v1.001</a>
        </div>
    </div>

</div>
<div class="content-box mb-3 content-lighten">
    <h3>ダウンロードファイルの内容</h3>
    <fieldset class="code">
        <legend>PerforceCheckOut.mac</legend>
        <pre class="brush:hmmacro;">#must_should_reopen = 0;
//上書き禁止を外しておこうか
if( readonly ) {
    #must_should_reopen = 1;
}

//-----------------------------------------------------------------------------
//このファイルをPerforceでチェックアウトする
//-----------------------------------------------------------------------------
// P4 更新
runex "p4 sync %f"
    , 1             //sync    0:async 1:sync
    , 0, ""         //stdin   0:none 1:auto 2:file 3:(reserve) 4:all 5:select
    , 8, ""         //stdout  0:none 1:auto 2:file 3:add file  4:new 5:insert 6:replace 7:output 8:add output
    , 8, ""         //stderr  0:none 1:=out/auto 2:file 3:add file  4:new 5:insert 6:replace 7:output 8:add output
    , 0, ""         //folder  0:none 1:current 2:specify 3:(reserve) 4:exe's folder
    , 0             //show    0:auto 1:show 2:hide
    , 0             //nodraw  0:draw 1:no draw
    , 0             //unicode 0:ansi 2:unicode
    ;

// P4 チェックアウトによるロック
runex "p4 edit %f"
    , 1             //sync    0:async 1:sync
    , 0, ""         //stdin   0:none 1:auto 2:file 3:(reserve) 4:all 5:select
    , 8, ""         //stdout  0:none 1:auto 2:file 3:add file  4:new 5:insert 6:replace 7:output 8:add output
    , 8, ""         //stderr  0:none 1:=out/auto 2:file 3:add file  4:new 5:insert 6:replace 7:output 8:add output
    , 0, ""         //folder  0:none 1:current 2:specify 3:(reserve) 4:exe's folder
    , 0             //show    0:auto 1:show 2:hide
    , 0             //nodraw  0:draw 1:no draw
    , 0             //unicode 0:ansi 2:unicode
    ;

if (filetype == ".lua") {
    setencode 6, 1, 2;
}

if (result==false) {

    message("チェックアウト失敗。");

} else {
    // チェックアウトする前、リードオンリーだったのだから、リオープンする。
    if( #must_should_reopen == 1 ) {
        reopen;
    }
}
</pre>
    </fieldset>
    <fieldset class="code">
        <legend>PerforceCheckIn.mac</legend>
        <pre class="brush:hmmacro;">//-----------------------------------------------------------------------------
//このファイルをPerforceでチェックインする
//-----------------------------------------------------------------------------

$str = input("コメント","");

if( !$str ) endmacro;    // コメント必須
if( !result ) endmacro;  // キャンセルされた

runex "p4 submit -d \"" + $str + "\" %f"
    , 0             //sync    0:async 1:sync
    , 0, ""         //stdin   0:none 1:auto 2:file 3:(reserve) 4:all 5:select
    , 8, ""         //stdout  0:none 1:auto 2:file 3:add file  4:new 5:insert 6:replace 7:output 8:add output
    , 8, ""         //stderr  0:none 1:=out/auto 2:file 3:add file  4:new 5:insert 6:replace 7:output 8:add output
    , 0, ""         //folder  0:none 1:current 2:specify 3:(reserve) 4:exe's folder
    , 0             //show    0:auto 1:show 2:hide
    , 0             //nodraw  0:draw 1:no draw
    , 0             //unicode 0:ansi 2:unicode
    ;

endmacro;
</pre>
    </fieldset>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>ライセンス</h3>
    <p>パブリックドメインとなります。</p>
</div>