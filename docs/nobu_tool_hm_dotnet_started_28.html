<div class="content-box mb-3 content-lighten">
    <h2><i class="fa fa-book fa-fw"></i>入門編 ～秀丸の設定に則った外部ファイルのエンコード判定～ (秀丸エディタ 8.90以降)</h2>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>概要</h3>
    <p>
        秀丸が対象の外部テキストを<mark>「これから」初めて「あなたの秀丸エディタ」で読み込んだと仮定</mark>すると、<br>
        秀丸は、対象のファイルをどのエンコードと判断するだろうか、その結果を取得する関数です。
    </p>
    <p>ポイントは<mark>「初めて」と「あなたの秀丸エディタ」の設定で読み込んだ</mark>場合、ということになります。<br>
        どのPCでも同じとなる汎用的な結果が返ってくる機能ではありません。<br></p>
    <p>設定は、秀丸より<mark>「その他」⇒「動作環境」⇒「ファイル」⇒「エンコード１」</mark>で主に設定されています。<br>
        この優先順位にしたがって判定され、また、チェックが付いていないエンコード値は、この関数では「取り扱わないもの」とされます。<br>
        <img src="./other_soft/hm_dotnet/cnt_hm_dotnet_encode_setting_01.png">
    </p>
    <p>
        このように、あくまでも「あなたの秀丸エディタの設定」と一致したエンコード情報が欲しい場合に、このメソッドを利用します。</p>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>
        秀丸でファイルのエンコードを取得する（秀丸に設定されている内容に従う）
    </h3>
    <p>マクロ中でもマクロ中以外でも、常時取得することが出来ます。</p>
    <blockquote>Hm.File.IEncoding Hm.File.GetEncoding( String filepath )</blockquote>
    <p>
        この返り値IEncoding型 には「MsCodePage」と「HmEncode」がプロパティとして存在します。<br>
        HmEncodeには、<a href="https://help.maruo.co.jp/hidemac/html/060_Keyword_State.html">秀丸マクロの「encode」の解説書</a> の「encode」の項目に対応する値が格納されています(※)。<br>
        MsCodePageには、秀丸の独自のencode値を、Windows上での「コードページ」の番号へと置き換えたものです。<br></p>

    <ul class="pointlist">
        <li>
            <h4>※秀丸の「encode」の値</h4>
            <fieldset class="code">
                <pre class="brush:csharp">0 　新規作成直後
1 　Shift-JIS
2 　Unicode(UTF-16)
3 　EUC
4 　JIS
5 　UTF-7
6 　UTF-8
7 　Unicode (UTF-16,Big-Endian)
8 　欧文
9 　簡体字中国語
10　繁体字中国語
11　韓国語
12　韓国語(Johab)
13　中央ヨーロッパ言語
14　バルト語
15　ギリシャ語
16　キリル言語
17　シンボル
18　トルコ語
19　ヘブライ語
20　アラビア語
21　タイ語
22　ベトナム語
23　Macintosh
24　OEM/DOS
25　その他
26　バイナリモード
27　Unicode(UTF-32) (V8.00以降)
28　Unicode(UTF-32,Big-Endian) (V8.00以降)
</pre>
            </fieldset>
    </li></ul>
    <ul class="pointlist">
        <li>
            <h4>C#側のソース</h4>
            <fieldset class="code">
                <legend>MyTestForm.cs</legend>
                <pre class="brush:csharp">using System;
using System.Windows.Forms;
using Hidemaru;

namespace HmTest
{
    partial class HmTestForm
    {
        protected void MethodCreate()
        {
            System.Diagnostics.Trace.WriteLine("フォーム生成時");
        }
        protected void MethodTick()
        {
            try
            {
                var target_filepath = @"D:\test\test.txt";

                // GetEncoding で、「HmEncode」と「MsCodePage」をプロパティとして持つオブジェクトが返ってくる。
                var encoding = Hm.File.GetEncoding(target_filepath);

                System.Diagnostics.Trace.WriteLine(encoding.HmEncode);
                System.Diagnostics.Trace.WriteLine(encoding.MsCodePage);

                // MsCodePage にはコードページ番号が入っているため、、.NET のSystem.Text.Encodingでテキストエンコードオブジェクトに逆引きできる。
                var text_encoding = System.Text.Encoding.GetEncoding(encoding.MsCodePage);

                // それを使えば、.NET の様々な読み取り系関数で利用することができる。
                var text = System.IO.File.ReadAllText(target_filepath, text_encoding);
            }
            catch (Exception e)
            {
                System.Diagnostics.Trace.WriteLine("エラーが発生:" + e.Message);
            }
        }
        protected void MethodDestroy()
        {
            System.Diagnostics.Trace.WriteLine("フォームクローズ時");
        }
    }
}
</pre>
            </fieldset>

        </li><li>
            <h4>秀丸マクロ側のソース</h4>
            <p>
                前章の「HmNETTest.mac」と同一です。<br>
                対象のパスにファイルを置いたり、ファイル名を変更したり、ファイルのエンコードを変更するなどして、<br>
                いろいろと挙動を確認してみましょう。<br>

                <br>
                特に、<mark>「その他」⇒「動作環境」⇒「ファイル」⇒「エンコード１」</mark> で判定対象となっていないエンコードの場合に、<br>
                強引にどれかに秀丸が当てはめようとしてしまうため、判定ミスが発生します。<br>

                <br>
                よって、この関数が使えるには、「対象のディレクトリには、自分自身が使っている秀丸なら一発でエンコードが正しく判断可能」でありという<br>
                「そういったファイル群に対してのみ自動で振り分けて処理をする」といった限られたシーンで利用することとなるでしょう。
            </p>
    </li></ul>
</div>