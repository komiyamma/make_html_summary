<div class="content-box mb-3 content-lighten">
    <h2><i class="fa fa-book fa-fw"></i>長大文字列を秀丸エディタに反映する</h2>
</div>

<div class="content-box mb-3 content-lighten">
    <h3>概要</h3>
    <p>秀丸マクロでは、「変数の合計のメモリ使用量」が制限されています。<br>
        (デフォルトでは1M)<br>
        このため、長大な文字列をhmPython3内で構築した場合に、これを秀丸エディタへと反映するには面倒な手順が必要でした。<br>
    </p>
    <p>しかし、以下のような工夫をすることで、この制限を回避する手段があります。</p>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>長大文字列の秀丸本体への反映</h3>
    <ul>
        <li><mark>マクロ変数を利用しなければ、何かの関数の結果を、別の関数等の引数へと渡した際、 メモリ制限を受けない</mark></li>
    </ul>
    <p>ようになっています。<br>
        この性質を利用して、</p>
    <div class="code">
        <pre class="brush:python;highlight:[18]">#PY = loaddll( hidemarudir + @"\hmPython3.dll" );

if ( !#PY ) {
    message("hmPython3.dllが導入されていません");
    endmacro;
}

#_ = dllfuncw(#PY, "DoString", R"PYTHON(
from hmPython import *

totalstring = "なんらかの手段によって、長大な文字列を構成"  # 現在のアクティブな(同じプロセスの)全テキストを取得
)PYTHON"
);

// 全て選択し
selectall;
// 秀丸エディタへと挿入する。この際に変数を介することなく、「dllfuncstrw」の返り値をそのまま引数として渡すことが重要。
insert dllfuncstrw( #PY, "GetStrVar", "totalstring" );
 
freedll( #PY );
</pre>
    </div>
    <p><mark>dllfuncstrwの返り値を一時変数で受け取らない</mark>ことが重要です。<br>
        これにより、秀丸に存在する「変数のメモリ制限」という制約を受けなくて済むため、<br>
        hmPython3で長大な文字列を生成したものをそのまま秀丸へと反映できます。</p>
    <p>例えば、次のようにしてしまうと、秀丸の「変数のメモリ制限(１つのマクロ内で使える全ての変数の合計量のメモリの制限)」の影響を受けてしまいます。<br>
    </p>
    <div class="code">
        <pre class="brush:python;first-line:13 highlight:[16, 17]">// 全て選択し
selectall;
// $retのように変数として受け取ってしまうと、秀丸マクロ自体が持つ「変数のメモリ制限」にひっかかる可能性があるため、長大な文字列を取り扱えなくなる。
$ret = dllfuncstrw( #PY, "GetStrVar", "totalstring" );
insert $ret;

freedll( #PY );
</pre>
    </div>
</div>