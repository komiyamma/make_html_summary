<div class="content-box mb-3 content-lighten">
    <h2><i class="fa fa-book fa-fw"></i>秀丸マクロの「(関数のような)命令文」を文字列で実行</h2>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>概要</h3>
    <p><mark>この機能を利用する場合、秀丸エディタ v8.98 (正式版 or β9以上)を強く推奨します。<br>
        そうでない場合、数値と文字列の型を間違えて実行すると秀丸が不正な状態となります。</mark></p>
        <p>
        hm.Macro.Eval(...)を「命令向けに特化」したものとして、「hm.Macro.Statement」が用意されています。
    </p>
    <p>秀丸マクロにおいて「(関数のような)文」や「(関数のような)命令文」とは</p>
    <blockquote>moveto Ｘ座標, Ｙ座標</blockquote>
    <p>のように呼び出しに<mark>「( )」が使われず</mark>、かつ、<mark>返り値を受け取らない</mark>ものです。</p>
    <p>一方、文と類似ですが<a href="?page=nobu_tool_hm_ecmascript_started_macro_function">「返り値」があり、「( )」を付けて呼び出すものを「関数」</a>としています。<br>
    </p>
</div>
<div class="content-box mb-3 content-lighten">
    <h3>
        秀丸マクロの(関数のような)文を実行可能です。<br>
    </h3>
    <blockquote>hm.Macro.Statement("秀丸マクロの文名", ...引数);</blockquote>
    <p>もしくは</p>
    <blockquote>hm.Macro.Statement.秀丸マクロの文名(...引数);</blockquote>
    <ul class="pointlist">
        <li>
            <h4>JavaScriptのソース</h4>
            <fieldset class="code">
                <legend>コード</legend>
                <pre class="brush:js">var ret = hm.Macro.Statement("moveto", 10, 2); // X:10, Y:2 の位置に移動
// もしくは
// var ret = hm.Macro.Statement.moveto(10, 2); // X:10, Y:2 の位置に移動

if (ret.Error == null )
{
    hm.OutputPane.Output("実行成功\r\n");
}
else
{
    hm.OutputPane.Output("実行失敗\r\n");
}
</pre>
            </fieldset>
        </li>
    </ul>
</div>

<div class="content-box mb-3 content-lighten">
    <h3>
        引数として「配列」を必要とする関数のような命令文
    </h3>
    <p>秀丸マクロの文や関数にはごく一部には「menuarray」など
        引数として「配列」を必要とするものがあります。</p>
    <p>今回は「<a href="https://help.maruo.co.jp/hidemac/html/120_InputStatement_menu_mousemenu_menuarray_mousemenuarray.html">秀丸マクロ文のmenuarray</a>」を利用してみましょう。</p>
    <ul class="pointlist">
        <li>
            <h4>JavaScript側のソース</h4>
            <fieldset class="code">
                <legend>コード</legend>
                <pre class="brush:js">menulist = [
    "１ばんめ",
    "２ばんめ",
    "３ばんめ"
];
var ret = hm.Macro.Statement("menuarray", menulist, menulist.length);
// もしくは
// var ret = hm.Macro.Statement.menuarray(menulist, menulist.length);
var selectedId = hm.Macro.Var["result"];
hm.OutputPane.Output(selectedId);
</pre>
            </fieldset>
        </li>
    </ul>
</div>

<div class="content-box mb-3 content-lighten">
    <h3>hm.Macro.Statement(...) 返り値</h3>

    <ul class="arrowlist">
        <li>
            <h5>Resultプロパティ</h5>
            <p>
                実行した秀丸マクロ文が無事成功したなら「秀丸マクロのresult相当の値が」、失敗したなら「0」以下がint型で入っています。<br>
                0とは限らないので注意してください。<br>
                ステートメントの実行そのものが成功したのかはResultプロパティではなくErrorプロパティで判定してください。<br>
                Resultプロパティでは実行に成功した結果、マイナスのresult値が返ってきていることもあり得ます。
            </p>
        </li>
        <li>
            <h5>Argsプロパティ</h5>
            <p>
                秀丸マク関数を実行した後、秀丸マクロ関数に渡した引数が最終的にどういった値になったかを取得できます。<br>
                List&lt;Object&gt;型で、関数に渡した最初の引数が[0], 次の引数が[1], ... といった形で格納されています。
            </p>
        </li>
        <li>
            <h5>Errorプロパティ</h5>
            <p>
                何か明確な例外が発生した場合はErrorプロパティにException型の例外インスタンスが入っています。<br>
                エラーがなければnullが入っています。
            </p>
        </li>
        <li>
            <h5>Messageプロパティ</h5>
            <p>
                基本的には特になにもはいっておらず、空文字が入っています。<br>
            </p>
        </li>
    </ul>
</div>